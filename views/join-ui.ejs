<!-- views/join-ui.ejs -->
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ... (head section remains unchanged) ... -->
</head>

<body>
  <h1>Welcome <%= username %> to the Join UI</h1>

  <!-- Display User Details -->
  <h2>User Details:</h2>
  <p>Username: <%= username %>
  </p>

  <!-- Display Room Information -->
  <h2>Room Information:</h2>
  <label for="roomUrl">Room URL:</label>
  <p id="roomUrl">
    <%= roomData.room_url %>
  </p>

  <label for="roomOwner">Room Owner:</label>
  <p id="roomOwner">
    <%= roomData.room_creator_username %>
  </p>

  <!-- Display User Messages -->
  <h2>User Messages:</h2>
  <ul>
    <% userMessages.forEach((message)=> { %>
      <li>
        <%= message %>
      </li>
      <% }); %>
  </ul>

  <!-- Messaging Form -->
  <form id="joinForm" action="/send-join-message" method="POST">
    <!-- Hidden input fields to include room data and username -->
    <input type="hidden" name="roomData" value='<%= JSON.stringify(roomData) %>'>
    <input type="hidden" name="username" value='<%= username %>'>

    <label for="joinMessage">Enter Message:</label>
    <input type="text" id="joinMessage" name="joinMessage" required>
    <button type="submit">Send</button>
  </form>

  <!-- Display Join Messages -->
  <ul id="joinMessages">
    <% userMessages.forEach((message)=> { %>
      <li>
        <%= message %>
      </li>
      <% }); %>
  </ul>
  <script>
    // Use JavaScript to handle form submission asynchronously
    document.addEventListener('DOMContentLoaded', () => {
      const joinForm = document.getElementById('joinForm');

      joinForm.addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent the default form submission behavior

        const formData = new FormData(joinForm);
        const joinMessage = formData.get('joinMessage');
        const roomData = formData.get('roomData');
        const username = formData.get('username');

        try {
          const response = await fetch('/send-join-message', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, joinMessage, roomData }),
          });

          if (!response.ok) {
            throw new Error(`Error sending join message: ${response.statusText}`);
          }

          console.log('Join message sent successfully.');

          // You can perform additional actions based on the response if needed

        } catch (error) {
          console.error(`Error sending join message: ${error.message}`);
        }
      });
    });

    // Display room information on the page
    document.getElementById('roomUrl').textContent = '<%= roomData.room_url %>';
    document.getElementById('roomOwner').textContent = '<%= roomData.room_creator_username %>';
  </script>
</body>

</html>
